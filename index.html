<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N2WG80YZD6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N2WG80YZD6');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Builder Quest</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f3f4f6; }
        #game-container, #form-container, #score-container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .rainbow-glow {
            position: relative;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 4px solid transparent;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            animation: rainbow-glow 5s linear infinite;
        }
        @keyframes rainbow-glow {
            0% { 
                border-color: red; 
                box-shadow: 0 0 20px red, 0 0 30px orange; 
            }
            14% { 
                border-color: orange; 
                box-shadow: 0 0 20px orange, 0 0 30px yellow; 
            }
            28% { 
                border-color: yellow; 
                box-shadow: 0 0 20px yellow, 0 0 30px green; 
            }
            42% { 
                border-color: green; 
                box-shadow: 0 0 20px green, 0 0 30px blue; 
            }
            57% { 
                border-color: blue; 
                box-shadow: 0 0 20px blue, 0 0 30px indigo; 
            }
            71% { 
                border-color: indigo; 
                box-shadow: 0 0 20px indigo, 0 0 30px violet; 
            }
            85% { 
                border-color: violet; 
                box-shadow: 0 0 20px violet, 0 0 30px red; 
            }
            100% { 
                border-color: red; 
                box-shadow: 0 0 20px red, 0 0 30px orange; 
            }
        }
        #quest-text {
            font-size: 1.5rem;
            font-weight: bold;
            font-family: 'Poppins', sans-serif;
            color: #1a202c;
            text-align: center;
        }
        #progress-tree { border: 2px solid #4b5563; border-radius: 8px; }
        #habit-log { height: 150px; overflow-y: auto; }
        .hidden { display: none; }
        #score-container {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            color: white;
            font-family: 'Poppins', sans-serif;
            border: 5px solid #ffd700;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        #score-container h1 {
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        #score-container p {
            font-size: 1.25rem;
            font-weight: bold;
        }
        #download-button {
            background: #ffd700;
            color: #1a202c;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 8px;
            transition: transform 0.2s;
        }
        #download-button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- Form Page -->
    <div id="form-container" class="bg-white shadow-lg rounded-lg p-6">
        <h1 class="text-3xl font-bold text-center mb-4">Habit Builder Quest</h1>
        <form id="player-form" class="space-y-4">
            <div>
                <label class="block text-gray-700">Name</label>
                <input type="text" id="name" class="w-full p-2 border rounded" required>
            </div>
            <div>
                <label class="block text-gray-700">Team</label>
                <input type="text" id="team" class="w-full p-2 border rounded" required>
            </div>
            <div>
                <label class="block text-gray-700">City</label>
                <input type="text" id="city" class="w-full p-2 border rounded" required>
            </div>
            <div>
                <label class="block text-gray-700">Cell Number</label>
                <input type="tel" id="cell" class="w-full p-2 border rounded" required>
            </div>
            <div>
                <label class="block text-gray-700">Date</label>
                <input type="date" id="date" class="w-full p-2 border rounded" required>
            </div>
            <div>
                <label class="block text-gray-700">Designation</label>
                <input type="text" id="designation" class="w-full p-2 border rounded" required>
            </div>
            <div>
                <label class="block text-gray-700">Select Habit</label>
                <select id="habit-type" class="w-full p-2 border rounded" required>
                    <option value="good">Adopt a Good Habit</option>
                    <option value="bad">Eliminate a Bad Habit</option>
                </select>
            </div>
            <div id="good-habits" class="hidden">
                <label class="block text-gray-700">Good Habit to Adopt</label>
                <select id="good-habit" class="w-full p-2 border rounded">
                    <option value="Drink water first thing in the morning">Drink water first thing in the morning</option>
                    <option value="Exercise for 30 minutes daily">Exercise for 30 minutes daily</option>
                    <option value="Read 10 pages of a book daily">Read 10 pages of a book daily</option>
                    <option value="Practice gratitude journaling">Practice gratitude journaling</option>
                    <option value="Meditate for 5 minutes daily">Meditate for 5 minutes daily</option>
                    <option value="Plan your day the night before">Plan your day the night before</option>
                    <option value="Eat a healthy breakfast">Eat a healthy breakfast</option>
                    <option value="Take 10,000 steps daily">Take 10,000 steps daily</option>
                    <option value="Practice deep breathing exercises">Practice deep breathing exercises</option>
                    <option value="Write down three daily goals">Write down three daily goals</option>
                    <option value="Limit screen time to 2 hours daily">Limit screen time to 2 hours daily</option>
                    <option value="Get 7–8 hours of sleep">Get 7–8 hours of sleep</option>
                    <option value="Compliment someone daily">Compliment someone daily</option>
                    <option value="Organize your workspace daily">Organize your workspace daily</option>
                    <option value="Learn a new skill weekly">Learn a new skill weekly</option>
                    <option value="Review your goals weekly">Review your goals weekly</option>
                    <option value="Stretch for 5 minutes daily">Stretch for 5 minutes daily</option>
                    <option value="Eat 5 servings of fruits/vegetables daily">Eat 5 servings of fruits/vegetables daily</option>
                    <option value="Save 10% of your income monthly">Save 10% of your income monthly</option>
                    <option value="Practice active listening in conversations">Practice active listening in conversations</option>
                </select>
            </div>
            <div id="bad-habits" class="hidden">
                <label class="block text-gray-700">Bad Habit to Eliminate</label>
                <select id="bad-habit" class="w-full p-2 border rounded">
                    <option value="Procrastinating on important tasks">Procrastinating on important tasks</option>
                    <option value="Checking social media excessively">Checking social media excessively</option>
                    <option value="Skipping breakfast">Skipping breakfast</option>
                    <option value="Staying up past midnight">Staying up past midnight</option>
                    <option value="Binge-watching TV shows">Binge-watching TV shows</option>
                    <option value="Drinking sugary beverages daily">Drinking sugary beverages daily</option>
                    <option value="Nail-biting">Nail-biting</option>
                    <option value="Overthinking decisions">Overthinking decisions</option>
                    <option value="Leaving dishes unwashed overnight">Leaving dishes unwashed overnight</option>
                    <option value="Multitasking during meetings">Multitasking during meetings</option>
                    <option value="Skipping workouts regularly">Skipping workouts regularly</option>
                    <option value="Impulse buying">Impulse buying</option>
                    <option value="Interrupting others while speaking">Interrupting others while speaking</option>
                    <option value="Leaving tasks incomplete">Leaving tasks incomplete</option>
                    <option value="Eating junk food late at night">Eating junk food late at night</option>
                    <option value="Ignoring emails for days">Ignoring emails for days</option>
                    <option value="Slouching while sitting">Slouching while sitting</option>
                    <option value="Comparing yourself to others">Comparing yourself to others</option>
                    <option value="Overspending on non-essentials">Overspending on non-essentials</option>
                    <option value="Negative self-talk">Negative self-talk</option>
                </select>
            </div>
            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Start Game</button>
        </form>
    </div>

    <!-- Game Page -->
    <div id="game-container" class="bg-white shadow-lg rounded-lg p-6 hidden">
        <h1 class="text-3xl font-bold text-center mb-4">Habit Builder Quest</h1>
        <p id="player-info" class="text-gray-700 mb-4"></p>
        <p id="selected-habit" class="text-lg font-medium mb-4"></p>
        <div id="progress-tree" class="mb-4 rainbow-border">
            <canvas id="tree-canvas"></canvas>
        </div>
        <div id="quest-area" class="mb-4 p-4">
            <h2 class="text-xl font-semibold">Quest <span id="quest-number">1</span>/12</h2>
            <div class="rainbow-glow">
                <p id="quest-text"></p>
            </div>
            <div id="choices" class="mt-4"></div>
        </div>
        <div id="habit-tracker" class="mb-4 rainbow-border p-4">
            <h2 class="text-xl font-semibold">Habit Tracker</h2>
            <ul id="habit-log" class="bg-gray-100 p-2 rounded"></ul>
        </div>
        <p id="score" class="text-lg font-medium">Growth Points: 0</p>
    </div>

    <!-- Score Card Page -->
    <div id="score-container" class="p-6 hidden">
        <h1 class="text-center mb-4">Habit Builder Quest Certificate</h1>
        <p id="player-details" class="text-center mb-4"></p>
        <p id="final-score" class="text-center mb-4"></p>
        <p id="encouragement" class="text-center mb-4 italic"></p>
        <p class="text-center.mb-4">"Small changes, remarkable results." – James Clear</p>
        <div class="flex justify-center space-x-4">
            <button id="download-button" class="font-bold">Download Certificate</button>
            <button id="home-button" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 font-bold">Back to Home</button>
        </div>
    </div>

    <script>
        let growthPoints = 0;
        let habits = [];
        let currentQuest = 0;
        let treeHeight = 50;
        let playerData = {};
        let selectedHabit = '';
        let habitType = '';
        let askedQuestions = [];

        const goodHabitQuestions = {
            cue: [
                {
                    text: "How can you make the cue for '{habit}' obvious?",
                    choices: [
                        { text: "Place a reminder in your environment (e.g., sticky note, visible item).", points: 10, feedback: "Great! Making cues obvious triggers the habit." },
                        { text: "Wait for inspiration to strike.", points: 0, feedback: "Inspiration is unreliable. Try a visible cue!" },
                        { text: "Hide all reminders of the habit.", points: 0, feedback: "Hiding cues makes habits harder to start." }
                    ]
                },
                {
                    text: "What's a good way to stack '{habit}' with an existing routine?",
                    choices: [
                        { text: "Pair it with a daily activity (e.g., after brushing teeth).", points: 10, feedback: "Perfect! Habit stacking links new habits to existing ones." },
                        { text: "Do it randomly throughout the day.", points: 0, feedback: "Random timing is inconsistent. Try stacking!" },
                        { text: "Only do it when you have extra time.", points: 0, feedback: "Waiting for extra time reduces consistency." }
                    ]
                },
                {
                    text: "How can you ensure the cue for '{habit}' is specific?",
                    choices: [
                        { text: "Set a specific time and place for the habit.", points: 10, feedback: "Excellent! Specificity strengthens cues." },
                        { text: "Keep the plan vague to stay flexible.", points: 0, feedback: "Vague plans lead to procrastination." },
                        { text: "Rely on others to remind you.", points: 0, feedback: "Self-reliance is key for consistent cues." }
                    ]
                },
                {
                    text: "How can you make the cue for '{habit}' consistent across days?",
                    choices: [
                        { text: "Use the same trigger every day (e.g., a specific time or event).", points: 10, feedback: "Great! Consistent cues build strong habits." },
                        { text: "Change the cue daily for variety.", points: 0, feedback: "Varying cues disrupts habit formation." },
                        { text: "Avoid setting any specific trigger.", points: 0, feedback: "No trigger leads to inconsistency." }
                    ]
                }
            ],
            craving: [
                {
                    text: "How can you make '{habit}' more attractive?",
                    choices: [
                        { text: "Associate it with something you enjoy (e.g., music, rewards).", points: 10, feedback: "Great! Making habits attractive increases motivation." },
                        { text: "Focus on the effort it requires.", points: 0, feedback: "Focusing on effort reduces appeal." },
                        { text: "Do it in an unpleasant environment.", points: 0, feedback: "Unpleasant settings discourage habits." }
                    ]
                },
                {
                    text: "How can you build anticipation for '{habit}'?",
                    choices: [
                        { text: "Visualize the benefits of doing it.", points: 10, feedback: "Perfect! Visualization creates craving." },
                        { text: "Think about the consequences of not doing it.", points: 0, feedback: "Negative focus reduces motivation." },
                        { text: "Ignore the outcomes and just start.", points: 0, feedback: "Ignoring outcomes misses the craving step." }
                    ]
                },
                {
                    text: "How can you use social influence for '{habit}'?",
                    choices: [
                        { text: "Join a group or share your goal with friends.", points: 10, feedback: "Excellent! Social support boosts craving." },
                        { text: "Keep your habit a secret.", points: 0, feedback: "Secrecy misses social motivation." },
                        { text: "Compete aggressively with others.", points: 0, feedback: "Competition can create stress, not craving." }
                    ]
                },
                {
                    text: "How can you make '{habit}' feel immediately rewarding?",
                    choices: [
                        { text: "Pair it with a small treat after completion.", points: 10, feedback: "Great! Immediate rewards enhance craving." },
                        { text: "Focus only on long-term benefits.", points: 0, feedback: "Long-term focus reduces immediate appeal." },
                        { text: "Make it feel like a chore.", points: 0, feedback: "Feeling like a chore kills motivation." }
                    ]
                }
            ],
            response: [
                {
                    text: "How can you make '{habit}' easy to do?",
                    choices: [
                        { text: "Start with a two-minute version of the habit.", points: 10, feedback: "Great! The two-minute rule reduces friction." },
                        { text: "Aim for perfection from the start.", points: 0, feedback: "Perfectionism creates barriers." },
                        { text: "Make it complex to feel accomplished.", points: 0, feedback: "Complexity hinders starting." }
                    ]
                },
                {
                    text: "How can you reduce friction for '{habit}'?",
                    choices: [
                        { text: "Prepare your environment in advance (e.g., set out tools).", points: 10, feedback: "Perfect! Reducing friction makes habits easier." },
                        { text: "Rely on willpower alone.", points: 0, feedback: "Willpower is unreliable long-term." },
                        { text: "Add unnecessary steps to the process.", points: 0, feedback: "Extra steps increase friction." }
                    ]
                },
                {
                    text: "How can you ensure consistency for '{habit}'?",
                    choices: [
                        { text: "Track your habit daily.", points: 10, feedback: "Excellent!-tracking builds consistency." },
                        { text: "Only do it when you feel like it.", points: 0, feedback: "Feelings are inconsistent. Try tracking!" },
                        { text: "Change the habit frequently.", points: 0, feedback: "Frequent changes disrupt consistency." }
                    ]
                },
                {
                    text: "How can you scale '{habit}' over time?",
                    choices: [
                        { text: "Gradually increase the habit’s intensity or duration.", points: 10, feedback: "Great! Gradual scaling builds sustainable habits." },
                        { text: "Keep it at the same level indefinitely.", points: 0, feedback: "Stagnation limits growth." },
                        { text: "Jump to advanced levels immediately.", points: 0, feedback: "Big jumps lead to burnout." }
                    ]
                }
            ],
            reward: [
                {
                    text: "How can you make '{habit}' satisfying?",
                    choices: [
                        { text: "Celebrate small wins immediately after doing it.", points: 10, feedback: "Great! Immediate rewards reinforce habits." },
                        { text: "Wait for long-term results to feel good.", points: 0, feedback: "Delayed rewards are less motivating." },
                        { text: "Criticize yourself for small mistakes.", points: 0, feedback: "Criticism reduces satisfaction." }
                    ]
                },
                {
                    text: "How can you track progress for '{habit}'?",
                    choices: [
                        { text: "Use a habit tracker to mark each completion.", points: 10, feedback: "Perfect! Tracking progress is rewarding." },
                        { text: "Rely on memory to track it.", points: 0, feedback: "Memory is unreliable for tracking." },
                        { text: "Only track big milestones.", points: 0, feedback: "Missing small wins reduces motivation." }
                    ]
                },
                {
                    text: "How can you reinforce '{habit}' long-term?",
                    choices: [
                        { text: "Tie it to your identity (e.g., 'I am a reader').", points: 10, feedback: "Excellent! Identity reinforces habits." },
                        { text: "Focus only on external rewards.", points: 0, feedback: "External rewards fade over time." },
                        { text: "Change your goal frequently.", points: 0, feedback: "Changing goals disrupts long-term habits." }
                    ]
                },
                {
                    text: "How can you make '{habit}' part of your lifestyle?",
                    choices: [
                        { text: "Integrate it into your daily routine permanently.", points: 10, feedback: "Great! Lifestyle integration ensures longevity." },
                        { text: "Treat it as a temporary challenge.", points: 0, feedback: "Temporary challenges fade." },
                        { text: "Only do it when convenient.", points: 0, feedback: "Convenience-based habits lack staying power." }
                    ]
                }
            ]
        };

        const badHabitQuestions = {
            cue: [
                {
                    text: "How can you remove the cue for '{habit}'?",
                    choices: [
                        { text: "Change your environment to eliminate triggers.", points: 10, feedback: "Great! Removing cues prevents bad habits." },
                        { text: "Keep the trigger in plain sight.", points: 0, feedback: "Visible triggers encourage bad habits." },
                        { text: "Rely on willpower to resist.", points: 0, feedback: "Willpower alone is unreliable." }
                    ]
                },
                {
                    text: "How can you disrupt the cue for '{habit}'?",
                    choices: [
                        { text: "Replace the bad habit with a good one at the same cue.", points: 10, feedback: "Perfect! Replacing cues redirects behavior." },
                        { text: "Ignore the cue and hope it goes away.", points: 0, feedback: "Ignoring cues doesn’t eliminate them." },
                        { text: "Make the cue more appealing.", points: 0, feedback: "Appealing cues strengthen bad habits." }
                    ]
                },
                {
                    text: "How can you make the cue for '{habit}' invisible?",
                    choices: [
                        { text: "Remove or hide the trigger from your environment.", points: 10, feedback: "Excellent! Invisible cues reduce temptation." },
                        { text: "Keep reminders of the habit around.", points: 0, feedback: "Reminders reinforce bad habits." },
                        { text: "Tell others to remind you of it.", points: 0, feedback: "External reminders keep cues active." }
                    ]
                },
                {
                    text: "How can you avoid situations that trigger '{habit}'?",
                    choices: [
                        { text: "Alter your routine to bypass triggering contexts.", points: 10, feedback: "Great! Avoiding triggers prevents the habit." },
                        { text: "Stay in the same triggering environments.", points: 0, feedback: "Familiar environments reinforce bad habits." },
                        { text: "Rely on distraction to avoid triggers.", points: 0, feedback: "Distraction is a weak long-term strategy." }
                    ]
                }
            ],
            craving: [
                {
                    text: "How can you make '{habit}' unattractive?",
                    choices: [
                        { text: "Focus on the negative consequences of the habit.", points: 10, feedback: "Great! Highlighting downsides reduces craving." },
                        { text: "Think about its short-term benefits.", points: 0, feedback: "Short-term benefits increase craving." },
                        { text: "Make it feel rewarding.", points: 0, feedback: "Rewards reinforce bad habits." }
                    ]
                },
                {
                    text: "How can you reduce the appeal of '{habit}'?",
                    choices: [
                        { text: "Associate it with something unpleasant.", points: 10, feedback: "Perfect! Unpleasant associations deter bad habits." },
                        { text: "Pair it with something you enjoy.", points: 0, feedback: "Enjoyable pairings increase craving." },
                        { text: "Ignore the habit’s impact.", points: 0, feedback: "Ignoring impact doesn’t reduce appeal." }
                    ]
                },
                {
                    text: "How can you use social influence to avoid '{habit}'?",
                    choices: [
                        { text: "Surround yourself with people who don’t do the habit.", points: 10, feedback: "Excellent! Social norms influence behavior." },
                        { text: "Join a group that encourages the habit.", points: 0, feedback: "That reinforces the bad habit." },
                        { text: "Keep your habit a secret.", points: 0, feedback: "Secrecy avoids accountability." }
                    ]
                },
                {
                    text: "How can you shift your mindset about '{habit}'?",
                    choices: [
                        { text: "Reframe it as something that conflicts with your values.", points: 10, feedback: "Great! Reframing reduces desire for the habit." },
                        { text: "Focus on its familiarity and comfort.", points: 0, feedback: "Comfort reinforces bad habits." },
                        { text: "Pretend the habit doesn’t exist.", points: 0, feedback: "Denial doesn’t address cravings." }
                    ]
                }
            ],
            response: [
                {
                    text: "How can you make '{habit}' difficult to do?",
                    choices: [
                        { text: "Add friction (e.g., remove easy access to the habit).", points: 10, feedback: "Great! Adding friction stops bad habits." },
                        { text: "Make it as easy as possible.", points: 0, feedback: "Ease enables bad habits." },
                        { text: "Rely on motivation to stop.", points: 0, feedback: "Motivation is unreliable for breaking habits." }
                    ]
                },
                {
                    text: "How can you interrupt the response for '{habit}'?",
                    choices: [
                        { text: "Create a commitment device (e.g., a penalty for doing it).", points: 10, feedback: "Perfect! Commitment devices disrupt bad habits." },
                        { text: "Allow yourself to do it occasionally.", points: 0, feedback: "Occasional indulgence keeps habits alive." },
                        { text: "Do nothing and hope it stops.", points: 0, feedback: "Inaction doesn’t break habits." }
                    ]
                },
                {
                    text: "How can you replace '{habit}' with a better response?",
                    choices: [
                        { text: "Substitute a positive habit in its place.", points: 10, feedback: "Excellent! Substitution redirects behavior." },
                        { text: "Keep the same response but do it less.", points: 0, feedback: "Reducing frequency isn’t enough." },
                        { text: "Focus on stopping without a replacement.", points: 0, feedback: "Stopping without replacement is hard." }
                    ]
                },
                {
                    text: "How can you create barriers to '{habit}'?",
                    choices: [
                        { text: "Make the habit inconvenient (e.g., lock away temptations).", points: 10, feedback: "Great! Barriers prevent bad habits." },
                        { text: "Keep temptations easily accessible.", points: 0, feedback: "Accessibility enables bad habits." },
                        { text: "Rely on self-control alone.", points: 0, feedback: "Self-control is unreliable long-term." }
                    ]
                }
            ],
            reward: [
                {
                    text: "How can you make '{habit}' unsatisfying?",
                    choices: [
                        { text: "Track the negative outcomes of doing it.", points: 10, feedback: "Great! Highlighting negatives reduces satisfaction." },
                        { text: "Reward yourself for doing it.", points: 0, feedback: "Rewards reinforce bad habits." },
                        { text: "Ignore the outcomes.", points: 0, feedback: "Ignoring outcomes doesn’t deter habits." }
                    ]
                },
                {
                    text: "How can you remove rewards for '{habit}'?",
                    choices: [
                        { text: "Eliminate immediate benefits of the habit.", points: 10, feedback: "Perfect! Removing rewards weakens habits." },
                        { text: "Celebrate after doing the habit.", points: 0, feedback: "Celebration reinforces bad habits." },
                        { text: "Focus only on long-term consequences.", points: 0, feedback: "Long-term focus is less effective." }
                    ]
                },
                {
                    text: "How can you reinforce avoiding '{habit}'?",
                    choices: [
                        { text: "Reward yourself for not doing the habit.", points: 10, feedback: "Excellent! Rewarding avoidance strengthens good behavior." },
                        { text: "Punish yourself for avoiding it.", points: 0, feedback: "Punishment can create negative associations." },
                        { text: "Do nothing when you avoid it.", points: 0, feedback: "No reinforcement misses motivation." }
                    ]
                },
                {
                    text: "How can you celebrate breaking '{habit}'?",
                    choices: [
                        { text: "Mark each day you avoid it with a positive action.", points: 10, feedback: "Great! Celebrating avoidance reinforces progress." },
                        { text: "Ignore your progress.", points: 0, feedback: "Ignoring progress reduces motivation." },
                        { text: "Focus only on the habit itself.", points: 0, feedback: "Focusing on the habit keeps it alive." }
                    ]
                }
            ]
        };

        function setup() {
            let canvas = createCanvas(400, 200);
            canvas.parent('tree-canvas');
        }

        function draw() {
            background(255);
            // Draw Progress Tree
            stroke(139, 69, 19);
            strokeWeight(10);
            line(200, 200, 200, 200 - treeHeight);
            noStroke();
            fill(34, 139, 34);
            ellipse(200, 200 - treeHeight, 50, 50);
        }

        // Form Handling
        document.getElementById('player-form').addEventListener('submit', (e) => {
            e.preventDefault();
            playerData = {
                name: document.getElementById('name').value,
                team: document.getElementById('team').value,
                city: document.getElementById('city').value,
                cell: document.getElementById('cell').value,
                date: document.getElementById('date').value,
                designation: document.getElementById('designation').value
            };
            habitType = document.getElementById('habit-type').value;
            selectedHabit = habitType === 'good' ? document.getElementById('good-habit').value : document.getElementById('bad-habit').value;
            document.getElementById('form-container').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            document.getElementById('player-info').innerText = `Player: ${playerData.name}, Team: ${playerData.team}, ${playerData.designation}, ${playerData.city}`;
            document.getElementById('selected-habit').innerText = `Habit: ${selectedHabit}`;
            updateQuest();
        });

        document.getElementById('habit-type').addEventListener('change', (e) => {
            document.getElementById('good-habits').classList.add('hidden');
            document.getElementById('bad-habits').classList.add('hidden');
            if (e.target.value === 'good') {
                document.getElementById('good-habits').classList.remove('hidden');
            } else {
                document.getElementById('bad-habits').classList.remove('hidden');
            }
        });

        // Quest Logic
        function updateQuest() {
            if (currentQuest < 12) {
                const stageOrder = ['cue', 'cue', 'cue', 'craving', 'craving', 'craving', 'response', 'response', 'response', 'reward', 'reward', 'reward'];
                const stage = stageOrder[currentQuest];
                const questions = habitType === 'good' ? goodHabitQuestions[stage] : badHabitQuestions[stage];
                // Filter out already asked questions for this stage
                const availableQuestions = questions.filter(q => !askedQuestions.includes(q.text));
                if (availableQuestions.length === 0) {
                    // Reset asked questions for this stage if none are available
                    askedQuestions = askedQuestions.filter(q => !questions.some(q2 => q2.text === q));
                }
                const question = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
                askedQuestions.push(question.text);
                document.getElementById('quest-number').innerText = currentQuest + 1;
                document.getElementById('quest-text').innerText = question.text.replace('{habit}', selectedHabit);
                let choicesDiv = document.getElementById('choices');
                choicesDiv.innerHTML = '';
                question.choices.forEach((choice, index) => {
                    let button = document.createElement('button');
                    button.className = 'bg-blue-500 text-white px-4 py-2 rounded mr-2 mb-2 hover:bg-blue-600';
                    button.innerText = choice.text;
                    button.onclick = () => {
                        makeChoice(choice);
                        currentQuest++;
                        updateQuest();
                    };
                    choicesDiv.appendChild(button);
                });
            } else {
                showScoreCard();
            }
        }

        function makeChoice(choice) {
            growthPoints += choice.points;
            treeHeight += choice.points * 2;
            habits.push({ action: choice.text, feedback: choice.feedback });
            updateHabitLog();
            updateScore();
        }

        function updateHabitLog() {
            let log = document.getElementById('habit-log');
            log.innerHTML = '';
            habits.forEach(habit => {
                let li = document.createElement('li');
                li.className = 'text-gray-600';
                li.innerText = `${habit.action}: ${habit.feedback}`;
                log.appendChild(li);
            });
        }

        function updateScore() {
            document.getElementById('score').innerText = `Growth Points: ${growthPoints}`;
        }

        function showScoreCard() {
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('score-container').classList.remove('hidden');
            document.getElementById('final-score').innerText = `Score: ${growthPoints}/120`;
            document.getElementById('player-details').innerText = `Awarded to ${playerData.name}\nTeam: ${playerData.team}\nDesignation: ${playerData.designation}\nCity: ${playerData.city}\nDate: ${playerData.date}`;
            let encouragement = '';
            if (growthPoints >= 100) {
                encouragement = "Outstanding! You've mastered the art of habit-building. Keep making those 1% improvements!";
            } else if (growthPoints >= 70) {
                encouragement = "Great job! You're well on your way to transforming your habits. Stay consistent!";
            } else if (growthPoints >= 40) {
                encouragement = "Nice effort! You've learned key strategies. Practice them daily to see big changes!";
            } else {
                encouragement = "Good start! Review the habit loop and try again to boost your score!";
            }
            document.getElementById('encouragement').innerText = encouragement;
        }

        document.getElementById('home-button').addEventListener('click', () => {
            document.getElementById('score-container').classList.add('hidden');
            document.getElementById('form-container').classList.remove('hidden');
            growthPoints = 0;
            habits = [];
            currentQuest = 0;
            treeHeight = 50;
            askedQuestions = [];
            document.getElementById('player-form').reset();
            document.getElementById('good-habits').classList.add('hidden');
            document.getElementById('bad-habits').classList.add('hidden');
            updateScore();
        });

        document.getElementById('download-button').addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Floral Border Pattern
            doc.setDrawColor(255, 182, 193); // Light pink for floral effect
            doc.setLineWidth(2);
            for (let x = 10; x <= 200; x += 10) {
                // Top and bottom borders
                doc.circle(x, 10, 3);
                doc.circle(x, 287, 3);
            }
            for (let y = 10; y <= 287; y += 10) {
                // Left and right borders
                doc.circle(10, y, 3);
                doc.circle(200, y, 3);
            }
            doc.setDrawColor(255, 215, 0); // Gold border outline
            doc.setLineWidth(1);
            doc.rect(8, 8, 194, 281); // Outer border

            // Certificate Content
            doc.setFont('Helvetica', 'bold');
            doc.setFontSize(24);
            doc.setTextColor(0, 102, 204);
            doc.text('Habit Builder Quest Certificate', 105, 30, { align: 'center' });

            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text(`Awarded to: ${playerData.name}`, 105, 60, { align: 'center' });
            doc.text(`Team: ${playerData.team}`, 105, 80, { align: 'center' });
            doc.text(`Designation: ${playerData.designation}`, 105, 100, { align: 'center' });
            doc.text(`City: ${playerData.city}`, 105, 120, { align: 'center' });
            doc.text(`Date: ${playerData.date}`, 105, 140, { align: 'center' });

            doc.setFontSize(20);
            doc.setTextColor(204, 0, 0);
            doc.text(`Score: ${growthPoints}/120`, 105, 170, { align: 'center' });

            doc.setFontSize(14);
            doc.setFont('Helvetica', 'italic');
            const encouragement = document.getElementById('encouragement').innerText;
            const splitText = doc.splitTextToSize(encouragement, 180);
            doc.text(splitText, 105, 190, { align: 'center' });

            doc.setFontSize(12);
            doc.setFont('Helvetica', 'normal');
            doc.text('"Small changes, remarkable results." – James Clear', 105, 240, { align: 'center' });

            doc.save(`Habit_Builder_Certificate_${playerData.name}.pdf`);
        });
    </script>
</body>
</html>
